(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[9401],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(h,r(r({ref:t},u),{},{components:n})):a.createElement(h,r({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},50746:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return p},default:function(){return c}});var a=n(22122),o=n(19756),i=(n(67294),n(3905)),r={sidebar_position:2},l="Getting Started",s={unversionedId:"getting-started",id:"version-0.5.0/getting-started",isDocsHomePage:!1,title:"Getting Started",description:"Weave GitOps makes it easy to get started on your GitOps journey; deploying your Kubernetes workloads in a way which is:",source:"@site/versioned_docs/version-0.5.0/getting-started.md",sourceDirName:".",slug:"/getting-started",permalink:"/docs/getting-started",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/main/versioned_docs/version-0.5.0/getting-started.md",version:"0.5.0",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"version-0.5.0/tutorialSidebar",previous:{title:"Installation",permalink:"/docs/installation"},next:{title:"gitops",permalink:"/docs/cli-reference/gitops"}},p=[{value:"Workshops",id:"workshops",children:[]},{value:"Pre-requisites",id:"pre-requisites",children:[]},{value:"Install the Weave GitOps CLI",id:"install-the-weave-gitops-cli",children:[]},{value:"Create your GitHub Repositories",id:"create-your-github-repositories",children:[{value:"1 - Create a configuration repository",id:"1---create-a-configuration-repository",children:[]},{value:"2 - Fork the podinfo sample application repository",id:"2---fork-the-podinfo-sample-application-repository",children:[]}]},{value:"Prepare your cluster",id:"prepare-your-cluster",children:[{value:"3 - Create the cluster",id:"3---create-the-cluster",children:[]},{value:"4 - Install Weave GitOps on the Kubernetes cluster",id:"4---install-weave-gitops-on-the-kubernetes-cluster",children:[]}]},{value:"Configure Weave GitOps to deploy the podinfo application",id:"configure-weave-gitops-to-deploy-the-podinfo-application",children:[{value:"5 - Start the GitOps Dashboard web UI",id:"5---start-the-gitops-dashboard-web-ui",children:[]},{value:"6 - Add the podinfo application",id:"6---add-the-podinfo-application",children:[]}]},{value:"View the running application",id:"view-the-running-application",children:[{value:"7 - See application details",id:"7---see-application-details",children:[]},{value:"8 - Access the running application",id:"8---access-the-running-application",children:[]}]},{value:"GitOps reconciliation in action",id:"gitops-reconciliation-in-action",children:[{value:"9 - Bad actor time, delete your application.",id:"9---bad-actor-time-delete-your-application",children:[]},{value:"9 - Make a (desired) change to your application",id:"9---make-a-desired-change-to-your-application",children:[]}]},{value:"Complete!",id:"complete",children:[{value:"Where next?",id:"where-next",children:[]}]}],u={toc:p};function c(e){var t=e.components,r=(0,o.Z)(e,["components"]);return(0,i.kt)("wrapper",(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"getting-started"},"Getting Started"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Weave GitOps")," makes it easy to get started on your GitOps journey; deploying your Kubernetes workloads in a way which is:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Declarative")," - desired state is expressed declaratively"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Versioned and immutable")," - including retaining complete version history"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Pulled Automatically")," - software agents automatically pull the desired state declarations from the source"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Continuously reconciled")," - software agents continuously observe actual system state and attempt to apply the desired state")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"See GitOps Principles v1.0.0 - ",(0,i.kt)("a",{parentName:"em",href:"https://opengitops.dev/"},"OpenGitOps"))),(0,i.kt)("p",null,"You can learn more about ",(0,i.kt)("a",{parentName:"p",href:"https://www.weave.works/technologies/gitops/"},"What is GitOps?")," and ",(0,i.kt)("a",{parentName:"p",href:"https://www.weave.works/product/gitops-core/"},"Weave GitOps")," at ",(0,i.kt)("a",{parentName:"p",href:"https://weave.works"},"weave.works"),"."),(0,i.kt)("p",null,"Now, let's get an app deployed with ",(0,i.kt)("strong",{parentName:"p"},"Weave GitOps"),"! This guide will walk you through a complete end-to-end scenario from creating a fresh local Kubernetes cluster, to having an application workload being deployed and managed through GitOps."),(0,i.kt)("p",null,"We will:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a new Kubernetes cluster"),(0,i.kt)("li",{parentName:"ul"},"Install the Weave GitOps CLI"),(0,i.kt)("li",{parentName:"ul"},"Deploy a sample application with Weave GitOps"),(0,i.kt)("li",{parentName:"ul"},"Show GitOps reconciliation by attempting a change to the app running on the cluster, then pushing a change to the application through git")),(0,i.kt)("h3",{id:"workshops"},"Workshops"),(0,i.kt)("p",null,"You can also join our regular workshops where we go through these steps together and can help you along the way:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Next workshop: 9 Dec 2021 - ",(0,i.kt)("a",{parentName:"li",href:"https://www.meetup.com/Weave-User-Group/"},"Intro to Kubernetes & GitOps + Free GitOps Workshop"))),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,i.kt)("p",null,"To follow along with this guide you will need:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"A GitHub account"),(0,i.kt)("li",{parentName:"ol"},"kubectl installed - ",(0,i.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/#kubectl"},"instructions")),(0,i.kt)("li",{parentName:"ol"},"For our Kubernetes cluster we use ",(0,i.kt)("a",{parentName:"li",href:"https://kind.sigs.k8s.io/docs/user/quick-start/"},"kind")," which requires ",(0,i.kt)("a",{parentName:"li",href:"https://docs.docker.com/get-docker/"},"Docker"),".")),(0,i.kt)("h2",{id:"install-the-weave-gitops-cli"},"Install the Weave GitOps CLI"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},'curl --silent --location "https://github.com/weaveworks/weave-gitops/releases/download/v0.4.1/gitops-$(uname)-$(uname -m).tar.gz" | tar xz -C /tmp\nsudo mv /tmp/gitops /usr/local/bin\ngitops version\n')),(0,i.kt)("p",null,"Alternatively, macOS users can use Homebrew:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"brew tap weaveworks/tap\nbrew install weaveworks/tap/gitops\n")),(0,i.kt)("p",null,"For complete installation instructions and general pre-requisites, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/installation"},"Installation page"),"."),(0,i.kt)("h2",{id:"create-your-github-repositories"},"Create your GitHub Repositories"),(0,i.kt)("p",null,"Weave GitOps can be used to deploy multiple applications, each with deployment manifests in their own separate repositories, to multiple Kubernetes clusters. We store the ",(0,i.kt)("a",{parentName:"p",href:"/docs/gitops-automation"},"GitOps Automation")," for one or more clusters in a single configuration repository for ease of management."),(0,i.kt)("p",null,"Whilst you can add the automation to any existing repository, including one with your application deployment manifests, we recommend using a new or empty repository for this purpose and our guide will take this approach."),(0,i.kt)("h3",{id:"1---create-a-configuration-repository"},"1 - Create a configuration repository"),(0,i.kt)("p",null,"This is where we will push GitOps Automation manifests. Storing in git allows for easy recovery and cluster bootstrapping."),(0,i.kt)("p",null,"From ",(0,i.kt)("a",{parentName:"p",href:"https://github.com"},"GitHub"),' click "+" and create a new repository; be sure to initialize the repository. This guide assumes the name ',(0,i.kt)("inlineCode",{parentName:"p"},"gitops-config")," is used."),(0,i.kt)("h3",{id:"2---fork-the-podinfo-sample-application-repository"},"2 - Fork the podinfo sample application repository"),(0,i.kt)("p",null,"We will be making changes to the sample application to show GitOps reconciliation in action. So we will first fork the podinfo sample repository."),(0,i.kt)("p",null,"Go to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wego-example/podinfo-deploy"},"https://github.com/wego-example/podinfo-deploy")," and fork the repository."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"fork",src:n(29995).Z})),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Podinfo")," is a simple web application written in Go made up of a frontend and backend component; it is designed to showcase best practices of running microservices in Kubernetes. The full application source can be found ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/stefanprodan/podinfo"},"here"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 backend\n\u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u251c\u2500\u2500 hpa.yaml\n\u2502   \u2514\u2500\u2500 service.yaml\n\u251c\u2500\u2500 frontend\n\u2502   \u251c\u2500\u2500 deployment.yaml\n\u2502   \u2514\u2500\u2500 service.yaml\n\u2514\u2500\u2500 namespace.yaml\n2 directories, 7 files\n")),(0,i.kt)("h2",{id:"prepare-your-cluster"},"Prepare your cluster"),(0,i.kt)("h3",{id:"3---create-the-cluster"},"3 - Create the cluster"),(0,i.kt)("p",null,"Open a terminal and enter the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kind create cluster\n")),(0,i.kt)("p",null,"You should see output similar to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'Creating cluster "kind" ...\n \u2713 Ensuring node image (kindest/node:v1.21.1) \ud83d\uddbc\n \u2713 Preparing nodes \ud83d\udce6\n \u2713 Writing configuration \ud83d\udcdc\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\n \u2713 Installing CNI \ud83d\udd0c\n \u2713 Installing StorageClass \ud83d\udcbe\nSet kubectl context to "kind-kind"\nYou can now use your cluster with:\nkubectl cluster-info --context kind-kind\n\nHave a nice day! \ud83d\udc4b\n\n')),(0,i.kt)("h3",{id:"4---install-weave-gitops-on-the-kubernetes-cluster"},"4 - Install Weave GitOps on the Kubernetes cluster"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"gitops install --app-config-url git@github.com:<username>/gitops-config\n")),(0,i.kt)("p",null,"Run the install command specifying the location of your configuration repository created in step 1."),(0,i.kt)("p",null,"The install will take roughly 2 minutes depending on your system."),(0,i.kt)("p",null,"Once complete, you will see:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"...\n\u25ce verifying installation\n\u2714 image-reflector-controller: deployment ready\n\u2714 image-automation-controller: deployment ready\n\u2714 source-controller: deployment ready\n\u2714 kustomize-controller: deployment ready\n\u2714 helm-controller: deployment ready\n\u2714 notification-controller: deployment ready\n\u2714 install finished\nDeploy key generated and uploaded to git provider\n\u25ba Writing manifests to disk\n\u25ba Committing and pushing gitops updates for application\n\u25ba Pushing app changes to repository\n\u25ba Applying manifests to the cluster\n")),(0,i.kt)("p",null,"This will commit a new ",(0,i.kt)("inlineCode",{parentName:"p"},".weave-gitops")," folder to your configuration repository with the following files to manage the Weave GitOps runtime on the specified cluster:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},".\n\u2514\u2500\u2500 clusters\n    \u2514\u2500\u2500 kind-kind\n        \u251c\u2500\u2500 system\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-source-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-system-kustomization-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-user-kustomization-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 gitops-runtime.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 wego-app.yaml\n        \u2502\xa0\xa0 \u2514\u2500\u2500 wego-system.yaml\n        \u2514\u2500\u2500 user\n            \u2514\u2500\u2500 .keep\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"flux-source-resource"),": a ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/docs/concepts/#sources"},(0,i.kt)("strong",{parentName:"a"},"GitRepository")),' source which "defines the origin of a repository containing the desired state of the system and the requirements to obtain it". This includes the ',(0,i.kt)("inlineCode",{parentName:"li"},"interval")," which is how frequently to check for available new versions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"flux-system-kustomization-resource"),": a ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/docs/concepts/#kustomization"},(0,i.kt)("strong",{parentName:"a"},"Flux Kustomization")),' which "represents a local set of Kubernetes resources (e.g. kustomize overlay) that Flux is supposed to reconcile in the cluster". This deploys the resources found under the specified path, in this case the ',(0,i.kt)("inlineCode",{parentName:"li"},"/system"),' folder, reconciling between the cluster and the declared state in Git. Where "if you make any changes to the cluster using kubectl edit/patch/delete, they will be promptly reverted." based on the ',(0,i.kt)("inlineCode",{parentName:"li"},"interval")," value."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"flux-user-kustomization-resource"),": another ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/docs/concepts/#kustomization"},(0,i.kt)("strong",{parentName:"a"},"Flux Kustomization")),", this time for anything in the ",(0,i.kt)("inlineCode",{parentName:"li"},"/user")," folder which later in this guide will include a reference to our sample application."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"gitops-runtime"),": which creates the ",(0,i.kt)("inlineCode",{parentName:"li"},"wego-system")," namespace and deploys the Flux runtime."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"wego-app"),": which deploys our on-cluster web UI (not currently exposed)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"wego-system"),": which creates our Application Custom Resource Definition (CRD).")),(0,i.kt)("p",null,"To learn more about these files, see our ",(0,i.kt)("a",{parentName:"p",href:"/docs/gitops-automation"},"GitOps Automation"),"."),(0,i.kt)("h2",{id:"configure-weave-gitops-to-deploy-the-podinfo-application"},"Configure Weave GitOps to deploy the podinfo application"),(0,i.kt)("h3",{id:"5---start-the-gitops-dashboard-web-ui"},"5 - Start the GitOps Dashboard web UI"),(0,i.kt)("p",null,"Weave GitOps provides a web UI to help manage the lifecycle management of your applications."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"gitops ui run\n")),(0,i.kt)("p",null,"Running the above command will open the dashboard in your browser at ",(0,i.kt)("a",{parentName:"p",href:"http://0.0.0.0:9001/"},"http://0.0.0.0:9001/"),"."),(0,i.kt)("p",null,"You will see an empty Applications view as shown in the image below."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"GitOps Dashboard web UI - empty applications view",src:n(37533).Z})),(0,i.kt)("h3",{id:"6---add-the-podinfo-application"},"6 - Add the podinfo application"),(0,i.kt)("p",null,"Click ",(0,i.kt)("strong",{parentName:"p"},"add application")," in the top right of the screen to bring up the following form:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"GitOps Dashboard web UI - add applications form",src:n(62934).Z})),(0,i.kt)("p",null,"Next fill out the form with the required values:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Name: ",(0,i.kt)("strong",{parentName:"li"},"podinfo-deploy")),(0,i.kt)("li",{parentName:"ul"},"Kubernetes Namespace: ",(0,i.kt)("strong",{parentName:"li"},"wego-system"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Leave as default"),", this is where the GitOps Automation objects for the application will be deployed."))),(0,i.kt)("li",{parentName:"ul"},"Source Repo URL: (",(0,i.kt)("strong",{parentName:"li"},"*",(0,i.kt)("a",{parentName:"strong",href:"mailto:git@github.com"},"git@github.com"),":\\<username",">","/podinfo-deploy"),")",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"URL references can be in either the HTTPS ",(0,i.kt)("inlineCode",{parentName:"li"},"https://github.com/sympatheticmoose/podinfo-deploy")," or SSH ",(0,i.kt)("inlineCode",{parentName:"li"},"git@github.com:sympatheticmoose/podinfo-deploy")," format."))),(0,i.kt)("li",{parentName:"ul"},"Config Repo URL: (",(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"mailto:git@github.com"},"git@github.com"),":\\<username",">","/gitops-config"),")",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Specify the same configuration repository from steps 1 and 4 (install)."))),(0,i.kt)("li",{parentName:"ul"},"Path: ",(0,i.kt)("strong",{parentName:"li"},"./"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Leave as default"),", this allows you to specify a particular folder with a repository, should the repo contain more than a single application's deployment manifests."))),(0,i.kt)("li",{parentName:"ul"},"Branch: (",(0,i.kt)("strong",{parentName:"li"},"should not require changing"),")")),(0,i.kt)("p",null,"Click ",(0,i.kt)("strong",{parentName:"p"},"AUTHENTICATE WITH GITHUB")," next to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Source Repo URL")," field."),(0,i.kt)("p",null,"You will be prompted with a screen to copy a code from, before visiting GitHub to authorize Weave GitOps with a short-lived token to write to your repositories. Copy the code to your clipboard and click ",(0,i.kt)("strong",{parentName:"p"},"AUTHORIZE GITHUB ACCESS"),"."),(0,i.kt)("p",null,"Paste the code into the screen as shown below:\n",(0,i.kt)("img",{alt:"device flow activation",src:n(34474).Z})),(0,i.kt)("p",null,"You should then see this confirmation:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"device flow complete",src:n(24583).Z})),(0,i.kt)("p",null,"Once authorization has completed, navigate back to the GitOps Dashboard."),(0,i.kt)("p",null,"Click ",(0,i.kt)("strong",{parentName:"p"},"Submit")," in the bottom right of the form."),(0,i.kt)("p",null,"The screen should update with a message that the Pull Request has been created, click ",(0,i.kt)("strong",{parentName:"p"},"Open Pull Requests")," to review the PR in GitHub."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Pull request raised",src:n(36186).Z})),(0,i.kt)("p",null,"The Pull Request adds five additional files under the ",(0,i.kt)("inlineCode",{parentName:"p"},".weave-gitops")," folder in your configuration repository. In a new ",(0,i.kt)("inlineCode",{parentName:"p"},"apps")," top level folder the following four files are added:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"app.yaml"),": An ",(0,i.kt)("strong",{parentName:"li"},"Application custom resource")," with details about the deployment."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"kustomization.yaml"),": a ",(0,i.kt)("a",{parentName:"li",href:"https://kubectl.docs.kubernetes.io/references/kustomize/glossary/#kustomization"},(0,i.kt)("strong",{parentName:"a"},"Kubernetes Kustomization"))," which references the resources within this folder to deploy the workload."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"podinfo-deploy-gitops-source"),": a ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/docs/concepts/#sources"},(0,i.kt)("strong",{parentName:"a"},"GitRepository"))," (described in step 4) for the application source repository."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"podinfo-deploy-gitops-deploy"),": a ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/docs/concepts/#kustomization"},(0,i.kt)("strong",{parentName:"a"},"Flux Kustomization"))," (described in step 4) to deploy the application. Note you can pause the reconciliation process using ",(0,i.kt)("inlineCode",{parentName:"li"},"gitops suspend <app-name>")," for i.e. debugging.")),(0,i.kt)("p",null,"Then in the ",(0,i.kt)("inlineCode",{parentName:"p"},"../clusters/kind-kind/user")," folder:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Another ",(0,i.kt)("a",{parentName:"li",href:"https://kubectl.docs.kubernetes.io/references/kustomize/glossary/#kustomization"},(0,i.kt)("strong",{parentName:"a"},"Kubernetes Kustomization"))," which associates the ",(0,i.kt)("inlineCode",{parentName:"li"},"podinfo-deploy")," application with your kind cluster as a target for its deployment.")),(0,i.kt)("p",null,"So now our ",(0,i.kt)("inlineCode",{parentName:"p"},".weave-gitops")," folder looks like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},".\n\u251c\u2500\u2500 apps\n\u2502\xa0\xa0 \u2514\u2500\u2500 podinfo-deploy\n\u2502\xa0\xa0     \u251c\u2500\u2500 app.yaml\n\u2502\xa0\xa0     \u251c\u2500\u2500 kustomization.yaml\n\u2502\xa0\xa0     \u251c\u2500\u2500 podinfo-deploy-gitops-deploy.yaml\n\u2502\xa0\xa0     \u2514\u2500\u2500 podinfo-deploy-gitops-source.yaml\n\u2514\u2500\u2500 clusters\n    \u2514\u2500\u2500 kind-kind\n        \u251c\u2500\u2500 system\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-source-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-system-kustomization-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 flux-user-kustomization-resource.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 gitops-runtime.yaml\n        \u2502\xa0\xa0 \u251c\u2500\u2500 wego-app.yaml\n        \u2502\xa0\xa0 \u2514\u2500\u2500 wego-system.yaml\n        \u2514\u2500\u2500 user\n            \u251c\u2500\u2500 .keep\n            \u2514\u2500\u2500 kustomization.yaml\n")),(0,i.kt)("p",null,"Merge the Pull Request to start the deployment."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Merge",src:n(44381).Z})),(0,i.kt)("h2",{id:"view-the-running-application"},"View the running application"),(0,i.kt)("h3",{id:"7---see-application-details"},"7 - See application details"),(0,i.kt)("p",null,"As the workloads begin to be deployed, you can view the progress and check for key reconciliation status updates in the Application details page."),(0,i.kt)("p",null,"Navigate to the Applications view by clicking in the left menu bar, you should now see the ",(0,i.kt)("inlineCode",{parentName:"p"},"podinfo-deploy")," application listed. Click the name of the Application to view the details page."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Weave GitOps UI",src:n(53193).Z})),(0,i.kt)("p",null,"From the Application details page you can see the reconciled objects on your cluster, which specific commit was last fetched from Git and which was last deployed onto the cluster. The ",(0,i.kt)("inlineCode",{parentName:"p"},"sync")," button allows you to force a reconciliation and bypass the ",(0,i.kt)("inlineCode",{parentName:"p"},"interval")," values. ",(0,i.kt)("inlineCode",{parentName:"p"},"Remove app")," will remove from GitHub repository and then the cluster as GitOps reconciliation takes effect."),(0,i.kt)("p",null,"You can also see the 10 most recent commits to your application source repository to quickly understand the changes which have occurred, with hyperlinks back to GitHub so you can find more details or revert changes as necessary."),(0,i.kt)("p",null,"As you can see, you have successfully deployed the app!"),(0,i.kt)("h3",{id:"8---access-the-running-application"},"8 - Access the running application"),(0,i.kt)("p",null,"To access the ",(0,i.kt)("inlineCode",{parentName:"p"},"podinfo")," UI you can set up a port forward into the pod."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kubectl port-forward service/frontend 9898:9898 --namespace test\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Forwarding from 127.0.0.1:9898 -> 9898\nForwarding from [::1]:9898 -> 9898\n")),(0,i.kt)("p",null,"Now you can browse ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:9898"},"http://localhost:9898"),"."),(0,i.kt)("p",null,"You should see something like:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Podinfo",src:n(56134).Z})),(0,i.kt)("p",null,"Use CTRL+C to cancel the ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl port-forward")," command to continue with your command prompt."),(0,i.kt)("h2",{id:"gitops-reconciliation-in-action"},"GitOps reconciliation in action"),(0,i.kt)("p",null,"The real aim of GitOps is not just to deploy once, but to continuously reconcile desired state in Git with live state in Kubernetes. So we will now show a change."),(0,i.kt)("h3",{id:"9---bad-actor-time-delete-your-application"},"9 - Bad actor time, delete your application."),(0,i.kt)("p",null,"Let's try deleting the ",(0,i.kt)("inlineCode",{parentName:"p"},"frontend")," deployment and seeing what happens."),(0,i.kt)("p",null,"First set up a watch on the pods"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get pods -n test --watch\n")),(0,i.kt)("p",null,"Now delete the deployment for ",(0,i.kt)("inlineCode",{parentName:"p"},"frontend")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl delete deployment/frontend -n test\n")),(0,i.kt)("p",null,"You will see the pod terminate, but after a short while, a new deployment will be created and a new pod created as drift was detected between our desired state and live state."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                        READY   STATUS    RESTARTS   AGE\nbackend-6b944d8b-hrg7f      1/1     Running   0          2m34s\nfrontend-64769bf658-b5nv6   1/1     Running   0          34s\nfrontend-64769bf658-b5nv6   1/1     Terminating   0          68s\nfrontend-64769bf658-b5nv6   0/1     Terminating   0          72s\nfrontend-64769bf658-b5nv6   0/1     Terminating   0          72s\nfrontend-64769bf658-b5nv6   0/1     Terminating   0          72s\nfrontend-64769bf658-mjjcs   0/1     Pending       0          0s\nfrontend-64769bf658-mjjcs   0/1     Pending       0          0s\nfrontend-64769bf658-mjjcs   0/1     ContainerCreating   0          0s\nfrontend-64769bf658-mjjcs   0/1     Running             0          2s\nfrontend-64769bf658-mjjcs   1/1     Running             0          11s\n")),(0,i.kt)("h3",{id:"9---make-a-desired-change-to-your-application"},"9 - Make a (desired) change to your application"),(0,i.kt)("p",null,"Edit ",(0,i.kt)("inlineCode",{parentName:"p"},"frontend/deployment.yaml")),(0,i.kt)("p",null,"Change the ",(0,i.kt)("inlineCode",{parentName:"p"},"PODINFO_UI_COLOR")," to grey:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'env:\n  - name: PODINFO_UI_COLOR\n    value: "#888888"\n')),(0,i.kt)("p",null,"You can do this through the GitHub web interface (including via pull request \u2665) or clone the repo locally and make the change as shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'git clone git@github:<username>/podinfo-deploy\n\n# make changes in /frontend/deployment.yaml\n\ngit add .\ngit commit -m "change color"\ngit push\n')),(0,i.kt)("p",null,"Now wait for the reconciliation to take place and you should see the pods recycle"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-console"},"kubectl get pods --namespace test\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                       READY   STATUS              RESTARTS   AGE\nbackend-5cd878f8dd-rl64h   1/1     Running             0          33m\nfrontend-5c45876f-pnxrq    1/1     Running             0          6m51s\nfrontend-ff74574fc-7ntw4   0/1     ContainerCreating   0          1s\n")),(0,i.kt)("p",null,"And a little later:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"NAME                       READY   STATUS        RESTARTS   AGE\nbackend-5cd878f8dd-rl64h   1/1     Running       0          34m\nfrontend-5c45876f-pnxrq    0/1     Terminating   0          7m9s\nfrontend-ff74574fc-7ntw4   1/1     Running       0          19s\n")),(0,i.kt)("p",null,"Notice that the backend has not changed and so the backend pod is not affected."),(0,i.kt)("p",null,"Restart ",(0,i.kt)("inlineCode",{parentName:"p"},"kubectl port-forward service/frontend 9898:9898 --namespace test")," and you will see the color has changed. NB: If you use a real ingress then you wouldn't need to do this."),(0,i.kt)("h2",{id:"complete"},"Complete!"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Congratulations!")," You have achieved a GitOps deployment using Weave GitOps. We hope you continue to be successful and are available for any questions or feedback in our ",(0,i.kt)("a",{parentName:"p",href:"https://weave-community.slack.com/archives/C0248LVC719"},"Slack"),"."),(0,i.kt)("h3",{id:"where-next"},"Where next?"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Learn more about GitOps from the Weaveworks ",(0,i.kt)("a",{parentName:"li",href:"https://www.weave.works/technologies/gitops/"},"Guide to GitOps")),(0,i.kt)("li",{parentName:"ul"},"Read more about the ",(0,i.kt)("a",{parentName:"li",href:"/docs/gitops-automation"},"GitOps Automation")," objects used to reconcile workloads"),(0,i.kt)("li",{parentName:"ul"},"Get to know our ",(0,i.kt)("a",{parentName:"li",href:"https://docs.gitops.weave.works/docs/cli-reference/gitops"},"CLI")),(0,i.kt)("li",{parentName:"ul"},"Get started with Cluster management with Weave GitOps Enterprise ",(0,i.kt)("a",{parentName:"li",href:"https://docs.gitops.weave.works/docs/cluster-management/getting-started"},"Weave GitOps Enterprise")),(0,i.kt)("li",{parentName:"ul"},"Dive into ",(0,i.kt)("a",{parentName:"li",href:"https://fluxcd.io/"},"Flux"),", the proven CNCF technology that provides the foundation for Weave GitOps, to learn about the configurations possible for your deployments")))}c.isMDXComponent=!0},36186:function(e,t,n){"use strict";t.Z=n.p+"assets/images/dashboard-add-application-PR-raised-a52c136f746f1387df373973f4e209ef.png"},62934:function(e,t,n){"use strict";t.Z=n.p+"assets/images/dashboard-add-form-complete-430401bd1ff613fd0b42430e0bf9c49d.png"},37533:function(e,t,n){"use strict";t.Z=n.p+"assets/images/dashboard-applications-empty-9ecc436ca4d687631e87d8d8bc30f2a4.png"},24583:function(e,t,n){"use strict";t.Z=n.p+"assets/images/github-device-flow-complete-f9a2e700c850d2f6c8dcfcff15db9988.png"},34474:function(e,t,n){"use strict";t.Z=n.p+"assets/images/github-device-flow-start-99ed021dad873ab80dc11e85d0259813.png"},29995:function(e,t,n){"use strict";t.Z=n.p+"assets/images/github-fork-57c2728ad86960ae6daf272d04c19190.png"},44381:function(e,t,n){"use strict";t.Z=n.p+"assets/images/podinfo-pr-merge-adcef3783f029ad5f534ff52c7865f2c.png"},56134:function(e,t,n){"use strict";t.Z=n.p+"assets/images/podinfo-web-3f7103ce3dff8fcf23baf6c1c9f64167.png"},53193:function(e,t,n){"use strict";t.Z=n.p+"assets/images/wego_ui-94190e05a64a5dd431347383af7f7dbf.png"}}]);