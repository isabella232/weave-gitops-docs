(self.webpackChunkweave_gitops_docs=self.webpackChunkweave_gitops_docs||[]).push([[1149],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return m},kt:function(){return h}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,m=p(e,["components","mdxType","originalType","parentName"]),c=l(n),h=i,d=c["".concat(s,".").concat(h)]||c[h]||u[h]||o;return n?a.createElement(d,r(r({ref:t},m),{},{components:n})):a.createElement(d,r({ref:t},m))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:i,r[1]=p;for(var l=2;l<o;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},20125:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return r},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return l},default:function(){return u}});var a=n(22122),i=n(19756),o=(n(67294),n(3905)),r={sidebar_position:7},p="GitOps Automation Configuration",s={unversionedId:"gitops-automation",id:"gitops-automation",isDocsHomePage:!1,title:"GitOps Automation Configuration",description:'Weave GitOps has a key concept which is the "GitOps Automation".',source:"@site/docs/gitops-automation.md",sourceDirName:".",slug:"/gitops-automation",permalink:"/docs/next/gitops-automation",editUrl:"https://github.com/weaveworks/weave-gitops-docs/edit/main/docs/gitops-automation.md",version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Deploying the Sock Shop Application",permalink:"/docs/next/examples/sock-shop"},next:{title:"Introduction",permalink:"/docs/next/cluster-management/intro"}},l=[{value:"What is the GitOps Automation Configuration?",id:"what-is-the-gitops-automation-configuration",children:[]},{value:"Where does it live?",id:"where-does-it-live",children:[]},{value:"What files are there",id:"what-files-are-there",children:[{value:"<code>app.yaml</code>",id:"appyaml",children:[]},{value:"<code>kustomization.yaml</code>",id:"kustomizationyaml",children:[]},{value:"<code>&lt;app name&gt;-gitops-source.yaml</code>",id:"app-name-gitops-sourceyaml",children:[]},{value:"<code>&lt;app name&gt;-gitops-deploy.yaml</code>",id:"app-name-gitops-deployyaml",children:[]}]}],m={toc:l};function u(e){var t=e.components,n=(0,i.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"gitops-automation-configuration"},"GitOps Automation Configuration"),(0,o.kt)("p",null,'Weave GitOps has a key concept which is the "GitOps Automation".\nThis is the configuration that defines the flow that happens when an update happens in Git. This flow ',(0,o.kt)("em",{parentName:"p"},"reconciles")," the workload into the target."),(0,o.kt)("h2",{id:"what-is-the-gitops-automation-configuration"},"What is the GitOps Automation Configuration?"),(0,o.kt)("p",null,"The GitOps Automation configuration consists of two types of configuration: ",(0,o.kt)("inlineCode",{parentName:"p"},"apps")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters"),".\nFundamentally, GitOps is connecting ",(0,o.kt)("inlineCode",{parentName:"p"},"apps")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters")," by automatically deploying the app into the cluster."),(0,o.kt)("h2",{id:"where-does-it-live"},"Where does it live?"),(0,o.kt)("p",null,"The configuration is stored in the repository specified in ",(0,o.kt)("inlineCode",{parentName:"p"},"gitops install"),". The application manifests can be stored in the same repository as the configuration or a separate repository."),(0,o.kt)("h2",{id:"what-files-are-there"},"What files are there"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},".weave-gitops")," folder contains the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},".weave-gitops\n\u251c\u2500\u2500 apps\n\u2502   \u2514\u2500\u2500 <app name>\n\u2502       \u251c\u2500\u2500 app.yaml\n\u2502       \u251c\u2500\u2500 kustomization.yaml\n\u2502       \u251c\u2500\u2500 <app name>-gitops-deploy.yaml\n\u2502       \u2514\u2500\u2500 <app name>-gitops-source.yaml\n\u2514\u2500\u2500 clusters\n    \u2514\u2500\u2500 <cluster name>\n        \u251c\u2500\u2500 system\n        \u2502   \u251c\u2500\u2500 flux-source-resource.yaml\n        \u2502   \u251c\u2500\u2500 flux-system-kustomization-resource.yaml\n        \u2502   \u251c\u2500\u2500 flux-user-kustomization-resource.yaml\n        \u2502   \u251c\u2500\u2500 gitops-runtime.yaml\n        \u2502   \u251c\u2500\u2500 wego-app.yaml\n        \u2502   \u2514\u2500\u2500 wego-system.yaml\n        \u2514\u2500\u2500 user\n            \u2514\u2500\u2500 kustomization.yaml\n")),(0,o.kt)("h3",{id:"appyaml"},(0,o.kt)("inlineCode",{parentName:"h3"},"app.yaml")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"app.yaml")," looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"---\napiVersion: wego.weave.works/v1alpha1\nkind: Application\nmetadata:\n  labels:\n    wego.weave.works/app-identifier: wego-52cdbd4b6d1a20a934f101708a93cf10\n  name: <app name>\n  namespace: wego-system\nspec:\n  branch: main\n  config_url: ssh://git@github.com/user/example.git\n  deployment_type: kustomize\n  path: ./\n  source_type: git\n  url: ssh://git@github.com/<yr-org-goes-here>/podinfo-deploy.git\n")),(0,o.kt)("p",null,"It defines:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"the name of the application (name)"),(0,o.kt)("li",{parentName:"ul"},"the namespace of the application (namespace)"),(0,o.kt)("li",{parentName:"ul"},"the git URL location of the repository, or URL of the helm repository for a helm chart (url)"),(0,o.kt)("li",{parentName:"ul"},"the path and branch containing the application manifests within the repository (path, branch)"),(0,o.kt)("li",{parentName:"ul"},"the git URL location of the configuration repository (config","_","url)"),(0,o.kt)("li",{parentName:"ul"},"whether the application will be read from a helm repository or a git repository (source","_","type)"),(0,o.kt)("li",{parentName:"ul"},"how the application will be deployed -- via kustomize or a helm release (deployment","_","type)")),(0,o.kt)("h3",{id:"kustomizationyaml"},(0,o.kt)("inlineCode",{parentName:"h3"},"kustomization.yaml")),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://kustomize.io/"},"kustomization.yaml")," file defines the set of resources that will be managed via GitOps for the application."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\nmetadata:\n  name: <app name>\n  namespace: wego-system\nresources:\n- app.yaml\n- <app name>-gitops-deploy.yaml\n- <app name>-gitops-source.yaml\n")),(0,o.kt)("p",null,"The content of each file mentioned in the ",(0,o.kt)("inlineCode",{parentName:"p"},"resources")," section is synchronized with the cluster by ",(0,o.kt)("inlineCode",{parentName:"p"},"flux"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"kustomization.yaml")," file itself is associated with the cluster via a reference to the app directory in the ",(0,o.kt)("inlineCode",{parentName:"p"},"user")," kustomization file for the cluster (",(0,o.kt)("inlineCode",{parentName:"p"},".weave-gitops/clusters/<cluster name>/user/kustomization.yaml"),")."),(0,o.kt)("h3",{id:"app-name-gitops-sourceyaml"},(0,o.kt)("inlineCode",{parentName:"h3"},"<app name>-gitops-source.yaml")),(0,o.kt)("p",null,"This file defines how the application will be read into the system. Current options are ",(0,o.kt)("inlineCode",{parentName:"p"},"GitRepository")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"HelmRepository"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: source.toolkit.fluxcd.io/v1beta1\nkind: GitRepository\nmetadata:\n  name: <app name>\n  namespace: wego-system\nspec:\n  ignore: |-\n    .weave-gitops/\n    .git/\n    .gitignore\n    .gitmodules\n    .gitattributes\n    *.jpg\n    *.jpeg\n    *.gif\n    *.png\n    *.wmv\n    *.flv\n    *.tar.gz\n    *.zip\n    .github/\n    .circleci/\n    .travis.yml\n    .gitlab-ci.yml\n    appveyor.yml\n    .drone.yml\n    cloudbuild.yaml\n    codeship-services.yml\n    codeship-steps.yml\n    **/.goreleaser.yml\n    **/.sops.yaml\n    **/.flux.yaml\n  interval: 30s\n  ref:\n    branch: main\n  url: https://github.com/<yr-org-goes-here>/podinfo-deploy.git\n")),(0,o.kt)("h3",{id:"app-name-gitops-deployyaml"},(0,o.kt)("inlineCode",{parentName:"h3"},"<app name>-gitops-deploy.yaml")),(0,o.kt)("p",null,"This file defines the flux runtime flow to deploy the application into a specific target.\nFor example, by default this uses the ",(0,o.kt)("a",{parentName:"p",href:"https://fluxcd.io/docs/components/kustomize/kustomization/"},"flux kustomize")," support\nto deploy your application manifests into the cluster. Other options include managing helm charts."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"---\napiVersion: kustomize.toolkit.fluxcd.io/v1beta2\nkind: Kustomization\nmetadata:\n  name: <app name>\n  namespace: wego-system\nspec:\n  interval: 1m0s\n  path: ./\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: <app name>\n")))}u.isMDXComponent=!0}}]);